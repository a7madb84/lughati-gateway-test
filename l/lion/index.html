<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¨ÙˆØ§Ø¨Ø© AR â€” Ø§Ù„Ø£Ø³Ø¯</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Arial;margin:24px;line-height:1.7}
    .card{max-width:560px;border:1px solid #ddd;border-radius:14px;padding:18px}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid #ccc;margin:10px 0}
    button{padding:12px 14px;border-radius:10px;border:0;cursor:pointer}
    .muted{color:#666;font-size:14px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø² â€” Ø§Ù„Ø£Ø³Ø¯</h2>
    <p id="status" class="muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚â€¦</p>

    <div id="lockedBox" style="display:none;">
      <p><strong>Standard Preview:</strong> Ù‡Ø°Ù‡ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø¯ÙˆÙ† AR. Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù‚ÙÙ„ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„.</p>
      <input id="code" placeholder="LG-AR-TEST-1234" />
      <button id="redeem">ØªÙØ¹ÙŠÙ„ ÙˆÙØªØ­ AR</button>
    </div>

    <div id="unlockedBox" style="display:none;">
      <p>âœ… Ù…ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².</p>
      <button id="openFull">ÙØªØ­ AR Ø§Ù„ÙƒØ§Ù…Ù„</button>
    </div>
  </div>

<script>
  const TOKEN_KEY = "LUGHATI_AR_TOKEN";

  async function resolve() {
    const token = localStorage.getItem(TOKEN_KEY) || "";
    const res = await fetch("/api/resolve", {
      headers: token ? { "Authorization": "Bearer " + token } : {}
    });

    if (res.ok) {
      const data = await res.json();
      document.getElementById("unlockedBox").style.display = "block";
      document.getElementById("lockedBox").style.display = "none";
      document.getElementById("status").textContent = "âœ… Ù…ÙØ¹Ù„: Ø³ÙŠØªÙ… ÙØªØ­ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©.";
      document.getElementById("openFull").onclick = () => window.location.href = data.url;
      // Ø§ÙØªØ­ Ù…Ø¨Ø§Ø´Ø±Ø©:
      window.location.href = data.url;
      return;
    }

    document.getElementById("lockedBox").style.display = "block";
    document.getElementById("unlockedBox").style.display = "none";
    document.getElementById("status").textContent = "ğŸ”’ ØºÙŠØ± Ù…ÙØ¹Ù„: Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„.";
  }

  document.getElementById("redeem").onclick = async () => {
    const code = (document.getElementById("code").value || "").trim();
    const res = await fetch("/api/redeem", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code })
    });
    const data = await res.json().catch(()=>({}));
    if (!res.ok || !data.token) return alert("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­.");

    localStorage.setItem(TOKEN_KEY, data.token);
    resolve();
  };

  resolve();
</script>
</body>
</html>
